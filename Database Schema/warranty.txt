-- Table: warranty.claim

-- DROP TABLE IF EXISTS warranty.claim;

CREATE TABLE IF NOT EXISTS warranty.claim
(
    claim_id bigint NOT NULL DEFAULT nextval('warranty.claim_claim_id_seq'::regclass),
    job_spare_id bigint NOT NULL,
    claim_status character varying(30) COLLATE pg_catalog."default" NOT NULL,
    portal_ref_no character varying(100) COLLATE pg_catalog."default",
    approval_date date,
    created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    so_number character varying(100) COLLATE pg_catalog."default" NOT NULL,
    remarks text COLLATE pg_catalog."default",
    CONSTRAINT claim_pkey PRIMARY KEY (claim_id),
    CONSTRAINT uq_warranty_so UNIQUE (so_number),
    CONSTRAINT fk_claim_spare FOREIGN KEY (job_spare_id)
        REFERENCES service.job_spare (job_spare_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT claim_claim_status_check CHECK (claim_status::text = ANY (ARRAY['RAISED'::character varying, 'APPROVED'::character varying, 'REJECTED'::character varying]::text[]))
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS warranty.claim
    OWNER to postgres;



-- Table: warranty.inward

-- DROP TABLE IF EXISTS warranty.inward;

CREATE TABLE IF NOT EXISTS warranty.inward
(
    warranty_inward_id bigint NOT NULL DEFAULT nextval('warranty.inward_warranty_inward_id_seq'::regclass),
    oem_invoice_no character varying(100) COLLATE pg_catalog."default" NOT NULL,
    oem_invoice_date date NOT NULL,
    remarks text COLLATE pg_catalog."default",
    created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT inward_pkey PRIMARY KEY (warranty_inward_id),
    CONSTRAINT uq_warranty_oem_invoice UNIQUE (oem_invoice_no)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS warranty.inward
    OWNER to postgres;



-- Table: warranty.inward_item

-- DROP TABLE IF EXISTS warranty.inward_item;

CREATE TABLE IF NOT EXISTS warranty.inward_item
(
    inward_item_id bigint NOT NULL DEFAULT nextval('warranty.inward_item_inward_item_id_seq'::regclass),
    warranty_inward_id bigint NOT NULL,
    spare_id bigint NOT NULL,
    quantity integer NOT NULL,
    unit_cost numeric(12,2),
    created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT inward_item_pkey PRIMARY KEY (inward_item_id),
    CONSTRAINT fk_warranty_inward FOREIGN KEY (warranty_inward_id)
        REFERENCES warranty.inward (warranty_inward_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT fk_warranty_inward_spare FOREIGN KEY (spare_id)
        REFERENCES inventory.spare_master (spare_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE RESTRICT,
    CONSTRAINT inward_item_quantity_check CHECK (quantity > 0)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS warranty.inward_item
    OWNER to postgres;



-- Table: warranty.shipment

-- DROP TABLE IF EXISTS warranty.shipment;

CREATE TABLE IF NOT EXISTS warranty.shipment
(
    shipment_id bigint NOT NULL DEFAULT nextval('warranty.shipment_shipment_id_seq'::regclass),
    courier_name character varying(100) COLLATE pg_catalog."default" NOT NULL,
    docket_no character varying(100) COLLATE pg_catalog."default" NOT NULL,
    dispatch_date date NOT NULL,
    received_date date,
    created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT shipment_pkey PRIMARY KEY (shipment_id),
    CONSTRAINT uq_warranty_docket UNIQUE (docket_no)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS warranty.shipment
    OWNER to postgres;



-- Table: warranty.shipment_item

-- DROP TABLE IF EXISTS warranty.shipment_item;

CREATE TABLE IF NOT EXISTS warranty.shipment_item
(
    shipment_item_id bigint NOT NULL DEFAULT nextval('warranty.shipment_item_shipment_item_id_seq'::regclass),
    shipment_id bigint NOT NULL,
    claim_id bigint NOT NULL,
    CONSTRAINT shipment_item_pkey PRIMARY KEY (shipment_item_id),
    CONSTRAINT uq_claim_single_shipment UNIQUE (claim_id),
    CONSTRAINT fk_ship_item_claim FOREIGN KEY (claim_id)
        REFERENCES warranty.claim (claim_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT fk_ship_item_shipment FOREIGN KEY (shipment_id)
        REFERENCES warranty.shipment (shipment_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS warranty.shipment_item
    OWNER to postgres;